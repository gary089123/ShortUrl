<!doctype html>
<html lang="en">
<head>


</head>

<body class="text-center">

<div class="cover-container-wide d-flex w-100 h-100 p-3 mx-auto flex-column">
  <%= flash_messages %>
  <%= render 'layouts/nav' %>


  <main role="main" class="inner cover text-left">
    <h3> Hi , <%= current_user.name %> </h3>
    <div class="url-scroll">
      <table class="table table-hover">
        <tbody>
        <% count = 0 %>
        <% @url_list.each do |url| %>
          <% count += 1 %>
          <tr>
            <td><%= url.id %></td>
            <td>
              <div class="btn-group">
                <button class="btn btn-sm btn-light">設定</button>
                <button class="btn btn-sm btn-success" data-toggle="modal" data-target="#chartModal" onclick="getchart(<%= url.id %>)">分析</button>
              </div>
            </td>
            <td>http://little.tw/<%= url.redirect %></td>
            <td style="white-space:nowrap;"><a href="<%= url.origin %>"><%= url.origin %></a></td>
          </tr>
        <% end %>


        </tbody>
      </table>
      <div class="modal fade modal-width" id="chartModal" tabindex="-1" role="dialog" aria-labelledby="chartModalTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title text-black-50" id="chartModalTitle">圖表分析</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-black-50" id="chartModalBody">
              <h2 class="text-center" id="url">url</h2>
              <div class="count text-center">
                Total Clicks
                <h3 id="click_count"> count </h3>
              </div>
              <canvas id="myChart" width="800" height="400"></canvas>


            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <%= form_for @url, :url => {:controller => 'urls', :action => 'create'} do |f| %>

      <div class="input-group">

        <%= f.text_field :origin, :class => "form-control", :style => "text-align:center;", placeholder: "Example : https://url.little.tw" %>
        <div class="input-group-append">
          <%= f.submit '產生短網址', :class => 'btn btn-info ml-2' %>
        </div>
      </div>
    <% end %>


  </main>

  <footer class="mastfoot mt-auto">
    <div class="inner">
      <p>Copyright © Gary-Yeh All rights reserved</p>
    </div>
  </footer>
</div>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
</body>
</html>


<!--
-->